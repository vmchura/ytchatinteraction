@import models.viewmodels.UserEventViewData

@(viewData: UserEventViewData)(implicit request: RequestHeader, flash: Flash)

@main("My Events", Some(viewData.user)) {
  <h1>My Active Events</h1>
  
  @if(!viewData.userEvents.hasActiveEvents) {
    <article>
      <p>You don't have any active events. Join a stream chat to participate in events!</p>
    </article>
  } else {
    <div class="grid">
      @for(event <- viewData.userEvents.activeEvents) {
        @partials.eventCard(event, viewData.userEvents.getBalanceForChannel(event.channelId))
      }
    </div>
  }

  @* Tournament Matches Section *@
  @partials.matchTable(viewData.matches)

  @* Available Events Section *@
  @partials.availableEvents(viewData.userEvents.availableEvents)

  @* Open Tournaments Section *@
  @if(viewData.tournaments.hasOpenTournaments) {
    <section>
      <h2>Open Tournaments</h2>
      <p>Tournaments currently open for registration:</p>
      
      <div class="grid">
        @for(tournament <- viewData.tournaments.openTournaments) {
          @partials.tournamentCard(tournament, viewData.tournaments.isUserRegistered(tournament))
        }
      </div>
    </section>
  }
  
  <!-- Enhanced JavaScript handling -->
  <script type='text/javascript' src='@routes.Assets.versioned("javascripts/userEventsInterface.js")' data-websocket-url='@viewData.webSocketUrl'></script>
  <script type='text/javascript' src='@routes.Assets.versioned("javascripts/events_updates.js")' data-url='@viewData.webSocketUrl'></script>
}

<script>
  // Set WebSocket URL in body data attribute for JavaScript access
  document.body.dataset.websocketUrl = '@viewData.webSocketUrl';
</script>
