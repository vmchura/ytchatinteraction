@import models.User
@import controllers.{StorageHealthStatus, HealthStatus}
@(user: Option[User], parserHealth: Option[HealthStatus] = None, storageHealth: Option[StorageHealthStatus] = None)(implicit flash: Flash)

@main("System Health", user) {
    <div id="health-container">
        <header>
            <h1>System Health Status</h1>
            <p>Current status of the StarCraft replay parsing service and file storage system</p>
        </header>

        <section>
            <div class="grid">
                <div>
                    <article id="health-status" class="@{parserHealth.map(h => s"status-${h.status}").getOrElse("loading")}">
                        <header>
                            <h3>Replay Parser Service</h3>
                        </header>
                        <div id="status-content">
                            @parserHealth match {
                                case Some(parser) => {
                                    <div class="metric">
                                        <span><span class="status-indicator @{parser.status}"></span>Status:</span>
                                        <strong>@{parser.status.capitalize}</strong>
                                    </div>
                                    <div class="metric">
                                        <span>Service:</span>
                                        <strong>@parser.service</strong>
                                    </div>
                                    <div class="metric">
                                        <span>Reachable:</span>
                                        <strong>@{if(parser.reachable) "Yes" else "No"}</strong>
                                    </div>
                                    @parser.responseTime.map { time =>
                                        <div class="metric">
                                            <span>Response Time:</span>
                                            <strong>@{time}ms</strong>
                                        </div>
                                    }
                                    @parser.error.map { error =>
                                        <div class="metric">
                                            <span>Error:</span>
                                            <strong style="color: var(--pico-color-red-500);">@error</strong>
                                        </div>
                                    }
                                }
                                case None => {
                                    <div>Health status not available</div>
                                }
                            }
                        </div>
                    </article>
                </div>
                
                <div>
                    <article id="storage-status" class="@{storageHealth.map(h => s"status-${h.status}").getOrElse("loading")}">
                        <header>
                            <h3>File Storage</h3>
                        </header>
                        <div id="storage-content">
                            @storageHealth match {
                                case Some(storage) => {
                                    <div class="metric">
                                        <span><span class="status-indicator @{storage.status}"></span>Status:</span>
                                        <strong>@{storage.status.capitalize}</strong>
                                    </div>
                                    <div class="metric">
                                        <span>Path:</span>
                                        <code>@storage.path</code>
                                    </div>
                                    <div class="metric">
                                        <span>Accessible:</span>
                                        <strong>@{if(storage.exists && storage.readable && storage.writable) "Yes" else "No"}</strong>
                                    </div>
                                    @storage.fileCount.map { count =>
                                        <div class="metric">
                                            <span>Files:</span>
                                            <strong>@count</strong>
                                        </div>
                                    }
                                    @storage.freeSpaceGB.map { free =>
                                        <div class="metric">
                                            <span>Free Space:</span>
                                            <strong>@{free}GB</strong>
                                        </div>
                                    }
                                    @storage.error.map { error =>
                                        <div class="metric">
                                            <span>Error:</span>
                                            <strong style="color: var(--pico-color-red-500);">@error</strong>
                                        </div>
                                    }
                                    <div class="metric">
                                        <span>Checked At:</span>
                                        <strong>@{java.time.Instant.parse(storage.checkedAt).toString}</strong>
                                    </div>
                                }
                                case None => {
                                    <div>Storage status not available</div>
                                }
                            }
                        </div>
                    </article>
                </div>
            </div>
        </section>

        <section>
            <div class="grid">
                <div>
                    <article>
                        <header>
                            <h3>Health Check Information</h3>
                        </header>
                        <div>
                            <p>This page shows the current health status of system services as of page load time.</p>
                            <p>The health checks are performed once when the page is rendered - there are no automatic recurring checks.</p>
                            <p>To refresh the status, simply reload this page.</p>
                        </div>
                    </article>
                </div>
                
                <div>
                    <article>
                        <header>
                            <h3>Manual Refresh</h3>
                        </header>
                        <div>
                            <p>To get updated health information:</p>
                            <button onclick="window.location.reload()" class="primary">Refresh Page</button>
                        </div>
                    </article>
                </div>
            </div>
        </section>
    </div>

    <style>
        .status-healthy {
            border-left: 4px solid var(--pico-color-green-500);
            background-color: var(--pico-color-green-100);
        }
        
        .status-unhealthy {
            border-left: 4px solid var(--pico-color-red-500);
            background-color: var(--pico-color-red-100);
        }
        
        .status-unreachable {
            border-left: 4px solid var(--pico-color-orange-500);
            background-color: var(--pico-color-orange-100);
        }
        
        .loading {
            border-left: 4px solid var(--pico-color-blue-500);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.healthy {
            background-color: var(--pico-color-green-500);
        }
        
        .status-indicator.unhealthy {
            background-color: var(--pico-color-red-500);
        }
        
        .status-indicator.unreachable {
            background-color: var(--pico-color-orange-500);
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }
        
        .metric strong {
            color: var(--pico-color);
        }
        
        code {
            background-color: var(--pico-color-slate-100);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        @@media (prefers-color-scheme: dark) {
            .status-healthy {
                background-color: var(--pico-color-green-900);
            }
            
            .status-unhealthy {
                background-color: var(--pico-color-red-900);
            }
            
            .status-unreachable {
                background-color: var(--pico-color-orange-900);
            }
            
            code {
                background-color: var(--pico-color-slate-800);
            }
        }
    </style>
}
