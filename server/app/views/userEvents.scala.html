@import models.viewmodels.UserEventViewData

@(viewData: UserEventViewData)(implicit request: RequestHeader, flash: Flash, messages: Messages)

@main(messages("events.title"), Some(viewData.user)) {
  <h1 id="my_event_active">@messages("events.active.title")</h1>
  
  @if(!viewData.userEvents.hasActiveEvents) {
    <article>
      <p>@messages("events.no.active")</p>
    </article>
  } else {
    <div class="grid">
      @for(event <- viewData.userEvents.activeEvents) {
        @partials.eventCard(event, viewData.userEvents.getBalanceForChannel(event.channelId))
      }
    </div>
  }

  @* Tournament Matches Section *@
  @partials.matchTable(viewData.user, viewData.matches)

  @* Available Events Section *@
  @partials.availableEvents(viewData.userEvents.availableEvents)

  @* Open Tournaments Section *@
  @if(viewData.tournaments.openTournaments.nonEmpty) {
    <section>
      <h2>@messages("events.tournaments.open.title")</h2>
      <p>@messages("events.tournaments.open.description")</p>
      
      <div class="grid">
        @for(tournament <- viewData.tournaments.openTournaments) {
          @partials.tournamentCardToRegister(tournament)
        }
      </div>
    </section>
  }

    @* In Progress Tournaments Section *@
    @if(viewData.tournaments.inProgressTournaments.nonEmpty) {
    <section>
        <h2>@messages("events.tournaments.in.progress.title")</h2>
        <p>@messages("events.tournaments.in.progress.description")</p>

        <div class="grid">
            @for(tournament <- viewData.tournaments.inProgressTournaments) {
            @partials.tournamentCardInProgress(tournament)
            }
        </div>
    </section>
    }
  
  <script type='text/javascript' src='@routes.Assets.versioned("javascripts/userEventsInterface.js")' data-websocket-url='@viewData.webSocketUrl'></script>
}

<script>
  // Set WebSocket URL in body data attribute for JavaScript access
  document.body.dataset.websocketUrl = '@viewData.webSocketUrl';
</script>
