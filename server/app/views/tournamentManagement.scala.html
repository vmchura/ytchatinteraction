@import play.api.mvc.ControllerHelpers.request2flash
@import models.{Tournament, TournamentRegistration, TournamentStatus, User}
@import java.time.format.DateTimeFormatter
@import java.time.ZoneId

@(tournamentsData: List[(Tournament, List[(TournamentRegistration, User)])])(implicit request: RequestHeader, messages: Messages, webJarsUtil: org.webjars.play.WebJarsUtil)

@main("Tournament Management") {
    <div class="container">
        <header>
            <h1>Tournament Management</h1>
            <p>Manage all tournaments from this dashboard.</p>
        </header>

        @if(request.flash.get("success").isDefined) {
            <div role="alert">
                @request.flash.get("success")
            </div>
        }

        @if(request.flash.get("error").isDefined) {
            <div role="alert">
                @request.flash.get("error")
            </div>
        }

        @if(tournamentsData.isEmpty) {
            <article>
                <header>
                    <h3>No Tournaments</h3>
                </header>
                <p>There are currently no tournaments.</p>
                <footer>
                    <a href="@routes.TournamentController.showCreateForm()" role="button">Create New Tournament</a>
                    <a href="@routes.HomeController.index()" role="button" class="secondary">Back to Home</a>
                </footer>
            </article>
        } else {
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Tournament Name</th>
                            <th>Status</th>
                            <th>Participants</th>
                            <th>Registration Ends</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for((tournament, registrations) <- tournamentsData.sortBy(_._1.registrationEndAt)) {
                            <tr>
                                <td>
                                    <strong>@tournament.name</strong>
                                    @tournament.description.map { desc =>
                                        <br><small>@desc</small>
                                    }
                                </td>
                                <td>
                                    @tournament.status match {
                                        case TournamentStatus.RegistrationOpen => {
                                            <mark style="background-color: var(--pico-green-400);">Open</mark>
                                        }
                                        case TournamentStatus.RegistrationClosed => {
                                            <mark style="background-color: var(--pico-orange-400);">Closed</mark>
                                        }
                                        case TournamentStatus.InProgress => {
                                            <mark style="background-color: var(--pico-primary);">In Progress</mark>
                                        }
                                        case TournamentStatus.Completed => {
                                            <mark style="background-color: var(--pico-gray-400);">Completed</mark>
                                        }
                                        case TournamentStatus.Cancelled => {
                                            <mark style="background-color: var(--pico-red-400);">Cancelled</mark>
                                        }
                                    }
                                </td>
                                <td>@registrations.length / @tournament.maxParticipants</td>
                                <td>
                                    @tournament.registrationEndAt.atZone(ZoneId.systemDefault()).format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm"))
                                </td>
                                <td>
                                    <a href="@routes.TournamentController.manageTournament(tournament.id)" role="button" class="secondary">Manage</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <footer style="margin-top: 2rem;">
                <a href="@routes.TournamentController.showCreateForm()" role="button">Create New Tournament</a>
                <a href="@routes.HomeController.index()" role="button" class="secondary">Back to Home</a>
            </footer>
        }
    </div>

}
